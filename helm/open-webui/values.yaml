# Default values for open-webui
# This is a YAML-formatted file.

# Domain and namespace configuration
domain: ai-k8s.svdevops.tech
namespace: ai
ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
  hosts:
    - host: ai-k8s.svdevops.tech
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: open-webui-tls
      hosts:
        - ai-k8s.svdevops.tech

# Image configuration
image:
  repository: ghcr.io/open-webui/open-webui
  tag: latest
  pullPolicy: IfNotPresent

# Replica configuration
# ⚠️ IMPORTANT: When using PVC with ReadWriteOnce (RWO), only 1 replica can be used
# If multiple replicas are needed, use ReadWriteMany (RWX) storage class or StatefulSet
replicaCount: 1

# Resource limits and requests (optimized based on real-world usage)
# Real usage: CPU: 6m, Memory: 618Mi
# Set with buffer for stable operation
resources:
  requests:
    memory: "256Mi"  # Reduced from 512Mi (real usage ~618Mi, but with buffer)
    cpu: "100m"      # Reduced from 250m (real usage ~6m)
  limits:
    memory: "1Gi"    # Reduced from 2Gi (real usage ~618Mi)
    cpu: "500m"      # Reduced from 1000m (real usage ~6m)

# Health checks
livenessProbe:
  httpGet:
    path: /api/health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /api/health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

startupProbe:
  httpGet:
    path: /api/health
    port: http
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 30

# Service configuration
service:
  type: ClusterIP
  port: 8080
  targetPort: 8080
  protocol: TCP

# Persistent Volume Configuration
persistence:
  enabled: true
  storageClass: standard-rwo
  accessMode: ReadWriteOnce
  size: 10Gi
  annotations: {}

# Environment variables for OpenRouter API
env:
  # OpenRouter API Configuration (OpenAI-compatible API)
  # OpenRouter provides 344+ AI models through a unified OpenAI-compatible API
  OPENAI__API_KEY: ""  # OpenRouter API key (set via Secret)
  OPENAI__API_BASE_URL: "https://openrouter.ai/api/v1"  # OpenRouter API endpoint
  OPENAI__EMBEDDING_MODEL: "text-embedding-3-small"
  
  # Application Configuration
  WEBUI_NAME: "Open WebUI"
  WEBUI_URL: "https://ai-k8s.svdevops.tech"
  WEBUI_SECRET_KEY: ""  # Should be set via Secret
  DEFAULT_USER_ROLE: "user"
  
  # Database Configuration
  DATA_DIR: "/app/backend/data"
  
  # Security
  ENABLE_SIGNUP: "true"
  ENABLE_SIGNUP_PROVIDER_AUTH: "false"
  
  # Monitoring
  ENABLE_METRICS: "true"
  METRICS_PORT: "9090"

# Secrets configuration (values should be set via external secrets or sealed secrets)
# IMPORTANT: Set these values before deploying!
# ⚠️ NEVER commit real secrets to Git! Use values.yaml.local or environment variables
# See SECRETS.md for instructions on how to set up secrets securely
secrets:
  enabled: true
  openrouterApiKey: ""  # OpenRouter API key - Set via environment variable or values.yaml.local
  webuiSecretKey: ""  # Auto-generate with: openssl rand -hex 32 - Set via environment variable or values.yaml.local

# ServiceMonitor for Prometheus
# ⚠️ Requires installed Prometheus Operator (CRD: monitoring.coreos.com/v1)
# Disabled by default. Enable after installing Prometheus Operator
serviceMonitor:
  enabled: false  # Set to true after installing Prometheus Operator
  interval: 30s
  scrapeTimeout: 10s
  path: /metrics
  port: metrics

# NetworkPolicy
networkPolicy:
  enabled: true
  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            name: monitoring
      ports:
      - protocol: TCP
        port: 9090
    - from:
      - namespaceSelector: {}
      ports:
      - protocol: TCP
        port: 8080
  egress:
    - to:
      - namespaceSelector: {}
      ports:
      - protocol: TCP
        port: 443
      - protocol: TCP
        port: 80
      - protocol: TCP
        port: 53
      - protocol: UDP
        port: 53

# Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "9090"
  prometheus.io/path: "/metrics"

# Pod security context
podSecurityContext:
  fsGroup: 1000
  runAsNonRoot: true
  runAsUser: 1000

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1000

# Node selector and tolerations
nodeSelector: {}

tolerations: []

affinity: {}

# Horizontal Pod Autoscaler
# ⚠️ IMPORTANT: Disabled because we use ReadWriteOnce (RWO) storage which only supports 1 pod
# If multiple replicas are needed, use ReadWriteMany (RWX) storage class or StatefulSet
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# ServiceAccount
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Image pull secrets
imagePullSecrets: []

